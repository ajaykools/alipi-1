import json
from pymongo import *
from bson.code import *
from pickle import *

#this file returns data.json, can be exploited later to return any file needed
def application(environ, start_response):
    #set the headers
    status = '200 OK'
    response_headers = [('Content-type', 'application/json'),( 'Access-Control-Allow-Origin', '*')]
    start_response(status, response_headers)
    
    try:
        #read the request
        recieved = environ['wsgi.input'].read(int(environ['CONTENT_LENGTH']))
        data = open("/var/www/wsgi/data.json", "rb").read()
    except KeyError:
        recieved = 'empty'
        print >> environ['wsgi.errors'], recieved
        #print >> environ['wsgi.errors'], environ['wsgi.input'].read(int(environ['CONTENT_LENGTH']))
        return recieved
    
    else:
        jsonData = json.loads(data)
        #print >> environ['wsgi.errors'], 
        return  json.dumps(jsonData)
       
        
